var bkExtend=function(){var d=arguments;if(d.length==1){d=[this,d[0]]}for(var c in d[1]){d[0][c]=d[1][c]}return d[0]};function bkClass(){}bkClass.prototype.construct=function(){};bkClass.extend=function(d){var e=function(){if(arguments[0]!==bkClass){return this.construct.apply(this,arguments)}};var f=new this(bkClass);bkExtend(f,d);e.prototype=f;e.extend=this.extend;return e};var bkElement=bkClass.extend({construct:function(c,d){if(typeof(c)=="string"){c=(d||document).createElement(c)}c=$BK(c);return c},appendTo:function(b){b.appendChild(this);return this},appendBefore:function(b){b.parentNode.insertBefore(this,b);return this},addEvent:function(c,d){bkLib.addEvent(this,c,d);return this},setContent:function(b){this.innerHTML=b;return this},pos:function(){var d=curtop=0;var f=obj=this;if(obj.offsetParent){do{d+=obj.offsetLeft;curtop+=obj.offsetTop}while(obj=obj.offsetParent)}var e=(!window.opera)?parseInt(this.getStyle("border-width")||this.style.border)||0:0;return[d+e,curtop+e+this.offsetHeight]},noSelect:function(){bkLib.noSelect(this);return this},parentTag:function(d){var c=this;do{if(c&&c.nodeName&&c.nodeName.toUpperCase()==d){return c}c=c.parentNode}while(c);return false},hasClass:function(b){return this.className.match(new RegExp("(\\s|^)nicEdit-"+b+"(\\s|$)"))},addClass:function(b){if(!this.hasClass(b)){this.className+=" nicEdit-"+b}return this},removeClass:function(b){if(this.hasClass(b)){this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+b+"(\\s|$)")," ")}return this},setStyle:function(e){var f=this.style;for(var d in e){switch(d){case"float":f.cssFloat=f.styleFloat=e[d];break;case"opacity":f.opacity=e[d];f.filter="alpha(opacity="+Math.round(e[d]*100)+")";break;case"className":this.className=e[d];break;default:f[d]=e[d]}}return this},getStyle:function(e,d){var f=(!d)?document.defaultView:d;if(this.nodeType==1){return(f&&f.getComputedStyle)?f.getComputedStyle(this,null).getPropertyValue(e):this.currentStyle[bkLib.camelize(e)]}},remove:function(){this.parentNode.removeChild(this);return this},setAttributes:function(d){for(var c in d){this[c]=d[c]}return this}});var bkLib={isMSIE:(navigator.appVersion.indexOf("MSIE")!=-1),addEvent:function(d,f,e){(d.addEventListener)?d.addEventListener(f,e,false):d.attachEvent("on"+f,e)},toArray:function(d){var f=d.length,e=new Array(f);while(f--){e[f]=d[f]}return e},noSelect:function(c){if(c.setAttribute&&c.nodeName.toLowerCase()!="input"&&c.nodeName.toLowerCase()!="textarea"){c.setAttribute("unselectable","on")}for(var d=0;d<c.childNodes.length;d++){bkLib.noSelect(c.childNodes[d])}},camelize:function(b){return b.replace(/\-(.)/g,function(d,a){return a.toUpperCase()})},inArray:function(d,c){return(bkLib.search(d,c)!=null)},search:function(e,d){for(var f=0;f<e.length;f++){if(e[f]==d){return f}}return null},cancelEvent:function(b){b=b||window.event;if(b.preventDefault&&b.stopPropagation){b.preventDefault();b.stopPropagation()}return false},domLoad:[],domLoaded:function(){if(arguments.callee.done){return}arguments.callee.done=true;for(i=0;i<bkLib.domLoad.length;i++){bkLib.domLoad[i]()}},onDomLoaded:function(b){this.domLoad.push(b);if(document.addEventListener){document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null)}else{if(bkLib.isMSIE){document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+((location.protocol=="https:")?"src='javascript:void(0)'":"src=//0")+"><\/script>");$BK("__ie_onload").onreadystatechange=function(){if(this.readyState=="complete"){bkLib.domLoaded()}}}}window.onload=bkLib.domLoaded}};function $BK(b){if(typeof(b)=="string"){b=document.getElementById(b)}return(b&&!b.appendTo)?bkExtend(b,bkElement.prototype):b}var bkEvent={addEvent:function(d,c){if(c){this.eventList=this.eventList||{};this.eventList[d]=this.eventList[d]||[];this.eventList[d].push(c)}return this},fireEvent:function(){var e=bkLib.toArray(arguments),d=e.shift();if(this.eventList&&this.eventList[d]){for(var f=0;f<this.eventList[d].length;f++){this.eventList[d][f].apply(this,e)}}}};function __(b){return b}Function.prototype.closure=function(){var e=this,f=bkLib.toArray(arguments),d=f.shift();return function(){if(typeof(bkLib)!="undefined"){return e.apply(d,f.concat(bkLib.toArray(arguments)))}}};Function.prototype.closureListener=function(){var e=this,d=bkLib.toArray(arguments),f=d.shift();return function(b){b=b||window.event;if(b.target){var a=b.target}else{var a=b.srcElement}return e.apply(f,[b,a].concat(d))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:true},center:{name:__("Center Align"),command:"justifycenter",noActive:true},right:{name:__("Right Align"),command:"justifyright",noActive:true},justify:{name:__("Justify Align"),command:"justifyfull",noActive:true},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:true},indent:{name:__("Indent Text"),command:"indent",noActive:true},outdent:{name:__("Remove Indent"),command:"outdent",noActive:true},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:true}},iconsPath:"../nicEditorIcons.gif",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor"],iconList:{xhtml:1,bgcolor:2,forecolor:3,bold:4,center:5,hr:6,indent:7,italic:8,justify:9,left:10,ol:11,outdent:12,removeformat:13,right:14,save:25,strikethrough:16,subscript:17,superscript:18,ul:19,underline:20,image:21,link:22,unlink:23,close:24,arrow:26,upload:27}});var nicEditors={nicPlugins:[],editors:[],registerPlugin:function(c,d){this.nicPlugins.push({p:c,o:d})},allTextAreas:function(d){var e=document.getElementsByTagName("textarea");for(var f=0;f<e.length;f++){nicEditors.editors.push(new nicEditor(d).panelInstance(e[f]))}return nicEditors.editors},findEditor:function(d){var f=nicEditors.editors;for(var e=0;e<f.length;e++){if(f[e].instanceById(d)){return f[e].instanceById(d)}}}};var nicEditor=bkClass.extend({construct:function(d){this.options=new nicEditorConfig();bkExtend(this.options,d);this.nicInstances=new Array();this.loadedPlugins=new Array();var e=nicEditors.nicPlugins;for(var f=0;f<e.length;f++){this.loadedPlugins.push(new e[f].p(this,e[f].o))}nicEditors.editors.push(this);bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(f,d){f=this.checkReplace($BK(f));var e=new bkElement("DIV").setStyle({width:(parseInt(f.getStyle("width"))||f.clientWidth)+"px"}).appendBefore(f);this.setPanel(e);return this.addInstance(f,d)},checkReplace:function(c){var d=nicEditors.findEditor(c);if(d){d.removeInstance(c);d.removePanel()}return c},addInstance:function(f,d){f=this.checkReplace($BK(f));if(f.contentEditable||!!window.opera){var e=new nicEditorInstance(f,d,this)}else{var e=new nicEditorIFrameInstance(f,d,this)}this.nicInstances.push(e);return this},removeInstance:function(d){d=$BK(d);var f=this.nicInstances;for(var e=0;e<f.length;e++){if(f[e].e==d){f[e].remove();this.nicInstances.splice(e,1)}}},removePanel:function(b){if(this.nicPanel){this.nicPanel.remove();this.nicPanel=null}},instanceById:function(d){d=$BK(d);var f=this.nicInstances;for(var e=0;e<f.length;e++){if(f[e].e==d){return f[e]}}},setPanel:function(b){this.nicPanel=new nicEditorPanel($BK(b),this.options,this);this.fireEvent("panel",this.nicPanel);return this},nicCommand:function(c,d){if(this.selectedInstance){this.selectedInstance.nicCommand(c,d)}},getIcon:function(e,f){var h=this.options.iconList[e];var g=(f.iconFiles)?f.iconFiles[e]:"";return{backgroundImage:"url('"+((h)?this.options.iconsPath:g)+"')",backgroundPosition:((h)?((h-1)*-18):0)+"px 0px"}},selectCheck:function(d,e){var f=false;do{if(e.className&&e.className.indexOf("nicEdit")!=-1){return false}}while(e=e.parentNode);this.fireEvent("blur",this.selectedInstance,e);this.lastSelectedInstance=this.selectedInstance;this.selectedInstance=null;return false}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:false,construct:function(q,n,m){this.ne=m;this.elm=this.e=q;this.options=n||{};newX=parseInt(q.getStyle("width"))||q.clientWidth;newY=parseInt(q.getStyle("height"))||q.clientHeight;this.initialHeight=newY-8;var j=(q.nodeName.toLowerCase()=="textarea");if(j||this.options.hasPanel){var l=(bkLib.isMSIE&&!((typeof document.body.style.maxHeight!="undefined")&&document.compatMode=="CSS1Compat"));var o={width:newX+"px",border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"};o[(l)?"height":"maxHeight"]=(this.ne.options.maxHeight)?this.ne.options.maxHeight+"px":null;this.editorContain=new bkElement("DIV").setStyle(o).appendBefore(q);var k=new bkElement("DIV").setStyle({width:(newX-8)+"px",margin:"4px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain);q.setStyle({display:"none"});k.innerHTML=q.innerHTML;if(j){k.setContent(q.value);this.copyElm=q;var p=q.parentTag("FORM");if(p){bkLib.addEvent(p,"submit",this.saveContent.closure(this))}}k.setStyle((l)?{height:newY+"px"}:{overflow:"hidden"});this.elm=k}this.ne.addEvent("blur",this.blur.closure(this));this.init();this.blur()},init:function(){this.elm.setAttribute("contentEditable","true");if(this.getContent()==""){this.setContent("<br />")}this.instanceDoc=document.defaultView;this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},remove:function(){this.saveContent();if(this.copyElm||this.options.hasPanel){this.editorContain.remove();this.e.setStyle({display:"block"});this.ne.removePanel()}this.disable();this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return(window.getSelection)?window.getSelection():document.selection},getRng:function(){var b=this.getSel();if(!b||b.rangeCount===0){return}return(b.rangeCount>0)?b.getRangeAt(0):b.createRange()},selRng:function(d,c){if(window.getSelection){c.removeAllRanges();c.addRange(d)}else{d.select()}},selElm:function(){var h=this.getRng();if(!h){return}if(h.startContainer){var e=h.startContainer;if(h.cloneContents().childNodes.length==1){for(var g=0;g<e.childNodes.length;g++){var f=e.childNodes[g].ownerDocument.createRange();f.selectNode(e.childNodes[g]);if(h.compareBoundaryPoints(Range.START_TO_START,f)!=1&&h.compareBoundaryPoints(Range.END_TO_END,f)!=-1){return $BK(e.childNodes[g])}}}return $BK(e)}else{return $BK((this.getSel().type=="Control")?h.item(0):h.parentElement())}},saveRng:function(){this.savedRange=this.getRng();this.savedSel=this.getSel()},restoreRng:function(){if(this.savedRange){this.selRng(this.savedRange,this.savedSel)}},keyDown:function(c,d){if(c.ctrlKey){this.ne.fireEvent("key",this,c)}},selected:function(d,e){if(!e&&!(e=this.selElm)){e=this.selElm()}if(!d.ctrlKey){var f=this.ne.selectedInstance;if(f!=this){if(f){this.ne.fireEvent("blur",f,e)}this.ne.selectedInstance=this;this.ne.fireEvent("focus",f,e)}this.ne.fireEvent("selected",f,e);this.isFocused=true;this.elm.addClass("selected")}return false},blur:function(){this.isFocused=false;this.elm.removeClass("selected")},saveContent:function(){if(this.copyElm||this.options.hasPanel){this.ne.fireEvent("save",this);(this.copyElm)?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent()}},getElm:function(){return this.elm},getContent:function(){this.content=this.getElm().innerHTML;this.ne.fireEvent("get",this);return this.content},setContent:function(b){this.content=b;this.ne.fireEvent("set",this);this.elm.innerHTML=this.content},nicCommand:function(c,d){document.execCommand(c,false,d)}});var nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var c=this.elm.innerHTML.replace(/^\s+|\s+$/g,"");this.elm.innerHTML="";(!c)?c="<br />":c;this.initialContent=c;this.elmFrame=new bkElement("iframe").setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm);if(this.copyElm){this.elmFrame.setStyle({width:(this.elm.offsetWidth-4)+"px"})}var d=["font-size","font-family","font-weight","color"];for(itm in d){this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm)}setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var c=$BK(this.elmFrame.contentWindow.document);c.designMode="on";c.open();var d=this.ne.options.externalCSS;c.write("<html><head>"+((d)?'<link href="'+d+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"</body></html>");c.close();this.frameDoc=c;this.frameWin=$BK(this.elmFrame.contentWindow);this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles);this.instanceDoc=this.frameWin.document.defaultView;this.heightUpdate();this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(b){this.content=b;this.ne.fireEvent("set",this);this.frameContent.innerHTML=this.content;this.heightUpdate()},getSel:function(){return(this.frameWin)?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(c,d){this.frameDoc.execCommand(c,false,d);setTimeout(this.heightUpdate.closure(this),100)}});var nicEditorPanel=bkClass.extend({construct:function(f,h,g){this.elm=f;this.options=h;this.ne=g;this.panelButtons=new Array();this.buttonList=bkExtend([],this.ne.options.buttonList);this.panelContain=new bkElement("DIV").setStyle({overflow:"hidden",width:"100%",border:"1px solid #cccccc",backgroundColor:"#efefef"}).addClass("panelContain");this.panelElm=new bkElement("DIV").setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(this.panelContain);this.panelContain.appendTo(f);var j=this.ne.options;var k=j.buttons;for(button in k){this.addButton(button,j,true)}this.reorder();f.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName];var type=(button.type)?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton;var hasButton=bkLib.inArray(this.buttonList,buttonName);if(type&&(hasButton||this.ne.options.fullPanel)){this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne));if(!hasButton){this.buttonList.push(buttonName)}}},findButton:function(c){for(var d=0;d<this.panelButtons.length;d++){if(this.panelButtons[d].name==c){return this.panelButtons[d]}}},reorder:function(){var d=this.buttonList;for(var f=0;f<d.length;f++){var e=this.findButton(d[f]);if(e){this.panelElm.appendChild(e.margin)}}},remove:function(){this.elm.remove()}});var nicEditorButton=bkClass.extend({construct:function(e,f,h,g){this.options=h.buttons[f];this.name=f;this.ne=g;this.elm=e;this.margin=new bkElement("DIV").setStyle({"float":"left",marginTop:"2px"}).appendTo(e);this.contain=new bkElement("DIV").setStyle({width:"20px",height:"20px"}).addClass("buttonContain").appendTo(this.margin);this.border=new bkElement("DIV").setStyle({backgroundColor:"#efefef",border:"1px solid #efefef"}).appendTo(this.contain);this.button=new bkElement("DIV").setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(this.ne.getIcon(f,h)).appendTo(this.border);this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect();if(!window.opera){this.button.onmousedown=this.button.onclick=bkLib.cancelEvent}g.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this));this.disable();this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){if(this.isDisabled){this.setBg()}else{if(this.isHover){this.setBg("hover")}else{if(this.isActive){this.setBg("active")}else{this.setBg()}}}},setBg:function(d){switch(d){case"hover":var c={border:"1px solid #666",backgroundColor:"#ddd"};break;case"active":var c={border:"1px solid #666",backgroundColor:"#ccc"};break;default:var c={border:"1px solid #efefef",backgroundColor:"#efefef"}}this.border.setStyle(c).addClass("button-"+d)},checkNodes:function(d){var c=d;do{if(this.options.tags&&bkLib.inArray(this.options.tags,c.nodeName)){this.activate();return true}}while(c=c.parentNode&&c.className!="nicEdit");c=$BK(d);while(c.nodeType==3){c=$BK(c.parentNode)}if(this.options.css){for(itm in this.options.css){if(c.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm]){this.activate();return true}}}this.deactivate();return false},activate:function(){if(!this.isDisabled){this.isActive=true;this.updateState();this.ne.fireEvent("buttonActivate",this)}},deactivate:function(){this.isActive=false;this.updateState();if(!this.isDisabled){this.ne.fireEvent("buttonDeactivate",this)}},enable:function(d,c){this.isDisabled=false;this.contain.setStyle({opacity:1}).addClass("buttonEnabled");this.updateState();this.checkNodes(c)},disable:function(d,c){this.isDisabled=true;this.contain.setStyle({opacity:0.6}).removeClass("buttonEnabled");this.updateState()},toggleActive:function(){(this.isActive)?this.deactivate():this.activate()},hoverOn:function(){if(!this.isDisabled){this.isHover=true;this.updateState();this.ne.fireEvent("buttonOver",this)}},hoverOff:function(){this.isHover=false;this.updateState();this.ne.fireEvent("buttonOut",this)},mouseClick:function(){if(this.options.command){this.ne.nicCommand(this.options.command,this.options.commandArgs);if(!this.options.noActive){this.toggleActive()}}this.ne.fireEvent("buttonClick",this)},key:function(d,c){if(this.options.key&&c.ctrlKey&&String.fromCharCode(c.keyCode||c.charCode).toLowerCase()==this.options.key){this.mouseClick();if(c.preventDefault){c.preventDefault()}}}});var nicPlugin=bkClass.extend({construct:function(c,d){this.options=d;this.ne=c;this.ne.addEvent("panel",this.loadPanel.closure(this));this.init()},loadPanel:function(d){var f=this.options.buttons;for(var e in f){d.addButton(e,this.options)}d.reorder()},init:function(){}});var nicPaneOptions={};var nicEditorPane=bkClass.extend({construct:function(e,h,g,f){this.ne=h;this.elm=e;this.pos=e.pos();this.contain=new bkElement("div").setStyle({zIndex:"99999",overflow:"hidden",position:"absolute",left:this.pos[0]+"px",top:this.pos[1]+"px"});this.pane=new bkElement("div").setStyle({fontSize:"12px",border:"1px solid #ccc",overflow:"hidden",padding:"4px",textAlign:"left",backgroundColor:"#ffffc9"}).addClass("pane").setStyle(g).appendTo(this.contain);if(f&&!f.options.noClose){this.close=new bkElement("div").setStyle({"float":"right",height:"16px",width:"16px",cursor:"pointer"}).setStyle(this.ne.getIcon("close",nicPaneOptions)).addEvent("mousedown",f.removePane.closure(this)).appendTo(this.pane)}this.contain.noSelect().appendTo(document.body);this.position();this.init()},init:function(){},position:function(){if(this.ne.nicPanel){var f=this.ne.nicPanel.elm;var e=f.pos();var d=e[0]+parseInt(f.getStyle("width"))-(parseInt(this.pane.getStyle("width"))+8);if(d<this.pos[0]){this.contain.setStyle({left:d+"px"})}}},toggle:function(){this.isVisible=!this.isVisible;this.contain.setStyle({display:((this.isVisible)?"block":"none")})},remove:function(){if(this.contain){this.contain.remove();this.contain=null}},append:function(b){b.appendTo(this.pane)},setContent:function(b){this.pane.setContent(b)}});var nicEditorAdvancedButton=nicEditorButton.extend({init:function(){this.ne.addEvent("selected",this.removePane.closure(this)).addEvent("blur",this.removePane.closure(this))},mouseClick:function(){if(!this.isDisabled){if(this.pane&&this.pane.pane){this.removePane()}else{this.pane=new nicEditorPane(this.contain,this.ne,{width:(this.width||"270px"),backgroundColor:"#fff"},this);this.addPane();this.ne.selectedInstance.saveRng()}}},addForm:function(l,h){this.form=new bkElement("form").addEvent("submit",this.submit.closureListener(this));this.pane.append(this.form);this.inputs={};for(itm in l){var m=l[itm];var o="";if(h){o=h.getAttribute(itm)}if(!o){o=m.value||""}var j=l[itm].type;if(j=="title"){new bkElement("div").setContent(m.txt).setStyle({fontSize:"14px",fontWeight:"bold",padding:"0px",margin:"2px 0"}).appendTo(this.form)}else{var k=new bkElement("div").setStyle({overflow:"hidden",clear:"both"}).appendTo(this.form);if(m.txt){new bkElement("label").setAttributes({"for":itm}).setContent(m.txt).setStyle({margin:"2px 4px",fontSize:"13px",width:"50px",lineHeight:"20px",textAlign:"right","float":"left"}).appendTo(k)}switch(j){case"text":this.inputs[itm]=new bkElement("input").setAttributes({id:itm,value:o,type:"text"}).setStyle({margin:"2px 0",fontSize:"13px","float":"left",height:"20px",border:"1px solid #ccc",overflow:"hidden"}).setStyle(m.style).appendTo(k);break;case"select":this.inputs[itm]=new bkElement("select").setAttributes({id:itm}).setStyle({border:"1px solid #ccc","float":"left",margin:"2px 0"}).appendTo(k);for(opt in m.options){var n=new bkElement("option").setAttributes({value:opt,selected:(opt==o)?"selected":""}).setContent(m.options[opt]).appendTo(this.inputs[itm])}break;case"content":this.inputs[itm]=new bkElement("textarea").setAttributes({id:itm}).setStyle({border:"1px solid #ccc","float":"left"}).setStyle(m.style).appendTo(k);this.inputs[itm].value=o}}}new bkElement("input").setAttributes({type:"submit"}).setStyle({backgroundColor:"#efefef",border:"1px solid #ccc",margin:"3px 0","float":"left",clear:"both"}).appendTo(this.form);this.form.onsubmit=bkLib.cancelEvent},submit:function(){},findElm:function(h,g,f){var k=this.ne.selectedInstance.getElm().getElementsByTagName(h);for(var j=0;j<k.length;j++){if(k[j].getAttribute(g)==f){return $BK(k[j])}}},removePane:function(){if(this.pane){this.pane.remove();this.pane=null;this.ne.selectedInstance.restoreRng()}}});var nicButtonTips=bkClass.extend({construct:function(b){this.ne=b;b.addEvent("buttonOver",this.show.closure(this)).addEvent("buttonOut",this.hide.closure(this))},show:function(b){this.timer=setTimeout(this.create.closure(this,b),400)},create:function(b){this.timer=null;if(!this.pane){this.pane=new nicEditorPane(b.button,this.ne,{fontSize:"12px",marginTop:"5px"});this.pane.setContent(b.options.name)}},hide:function(b){if(this.timer){clearTimeout(this.timer)}if(this.pane){this.pane=this.pane.remove()}}});nicEditors.registerPlugin(nicButtonTips);var nicSelectOptions={buttons:{fontSize:{name:__("Select Font Size"),type:"nicEditorFontSizeSelect",command:"fontsize"},fontFamily:{name:__("Select Font Family"),type:"nicEditorFontFamilySelect",command:"fontname"},fontFormat:{name:__("Select Font Format"),type:"nicEditorFontFormatSelect",command:"formatBlock"}}};var nicEditorSelect=bkClass.extend({construct:function(e,f,h,g){this.options=h.buttons[f];this.elm=e;this.ne=g;this.name=f;this.selOptions=new Array();this.margin=new bkElement("div").setStyle({"float":"left",margin:"2px 1px 0 1px"}).appendTo(this.elm);this.contain=new bkElement("div").setStyle({width:"90px",height:"20px",cursor:"pointer",overflow:"hidden"}).addClass("selectContain").addEvent("click",this.toggle.closure(this)).appendTo(this.margin);this.items=new bkElement("div").setStyle({overflow:"hidden",zoom:1,border:"1px solid #ccc",paddingLeft:"3px",backgroundColor:"#fff"}).appendTo(this.contain);this.control=new bkElement("div").setStyle({overflow:"hidden","float":"right",height:"18px",width:"16px"}).addClass("selectControl").setStyle(this.ne.getIcon("arrow",h)).appendTo(this.items);this.txt=new bkElement("div").setStyle({overflow:"hidden","float":"left",width:"66px",height:"14px",marginTop:"1px",fontFamily:"sans-serif",textAlign:"center",fontSize:"12px"}).addClass("selectTxt").appendTo(this.items);if(!window.opera){this.contain.onmousedown=this.control.onmousedown=this.txt.onmousedown=bkLib.cancelEvent}this.margin.noSelect();this.ne.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this));this.disable();this.init()},disable:function(){this.isDisabled=true;this.close();this.contain.setStyle({opacity:0.6})},enable:function(b){this.isDisabled=false;this.close();this.contain.setStyle({opacity:1})},setDisplay:function(b){this.txt.setContent(b)},toggle:function(){if(!this.isDisabled){(this.pane)?this.close():this.open()}},open:function(){this.pane=new nicEditorPane(this.items,this.ne,{width:"88px",padding:"0px",borderTop:0,borderLeft:"1px solid #ccc",borderRight:"1px solid #ccc",borderBottom:"0px",backgroundColor:"#fff"});for(var h=0;h<this.selOptions.length;h++){var g=this.selOptions[h];var f=new bkElement("div").setStyle({overflow:"hidden",borderBottom:"1px solid #ccc",width:"88px",textAlign:"left",overflow:"hidden",cursor:"pointer"});var e=new bkElement("div").setStyle({padding:"0px 4px"}).setContent(g[1]).appendTo(f).noSelect();e.addEvent("click",this.update.closure(this,g[0])).addEvent("mouseover",this.over.closure(this,e)).addEvent("mouseout",this.out.closure(this,e)).setAttributes("id",g[0]);this.pane.append(f);if(!window.opera){e.onmousedown=bkLib.cancelEvent}}},close:function(){if(this.pane){this.pane=this.pane.remove()}},over:function(b){b.setStyle({backgroundColor:"#ccc"})},out:function(b){b.setStyle({backgroundColor:"#fff"})},add:function(c,d){this.selOptions.push(new Array(c,d))},update:function(b){this.ne.nicCommand(this.options.command,b);this.close()}});var nicEditorFontSizeSelect=nicEditorSelect.extend({sel:{1:"1&nbsp;(8pt)",2:"2&nbsp;(10pt)",3:"3&nbsp;(12pt)",4:"4&nbsp;(14pt)",5:"5&nbsp;(18pt)",6:"6&nbsp;(24pt)"},init:function(){this.setDisplay("Font&nbsp;Size...");for(itm in this.sel){this.add(itm,'<font size="'+itm+'">'+this.sel[itm]+"</font>")}}});var nicEditorFontFamilySelect=nicEditorSelect.extend({sel:{arial:"Arial","comic sans ms":"Comic Sans","courier new":"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact","times new roman":"Times","trebuchet ms":"Trebuchet",verdana:"Verdana"},init:function(){this.setDisplay("Font&nbsp;Family...");for(itm in this.sel){this.add(itm,'<font face="'+itm+'">'+this.sel[itm]+"</font>")}}});var nicEditorFontFormatSelect=nicEditorSelect.extend({sel:{p:"Paragraph",pre:"Pre",h6:"Heading&nbsp;6",h5:"Heading&nbsp;5",h4:"Heading&nbsp;4",h3:"Heading&nbsp;3",h2:"Heading&nbsp;2",h1:"Heading&nbsp;1"},init:function(){this.setDisplay("Font&nbsp;Format...");for(itm in this.sel){var b=itm.toUpperCase();this.add("<"+b+">","<"+itm+' style="padding: 0px; margin: 0px;">'+this.sel[itm]+"</"+b+">")}}});nicEditors.registerPlugin(nicPlugin,nicSelectOptions);var nicLinkOptions={buttons:{link:{name:"Add Link",type:"nicLinkButton",tags:["A"]},unlink:{name:"Remove Link",command:"unlink",noActive:true}}};var nicLinkButton=nicEditorAdvancedButton.extend({addPane:function(){this.ln=this.ne.selectedInstance.selElm().parentTag("A");this.addForm({"":{type:"title",txt:"Add/Edit Link"},href:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},title:{type:"text",txt:"Title"},target:{type:"select",txt:"Open In",options:{"":"Current Window",_blank:"New Window"},style:{width:"100px"}}},this.ln)},submit:function(d){var e=this.inputs.href.value;if(e=="http://"||e==""){alert("You must enter a URL to Create a Link");return false}this.removePane();if(!this.ln){var f="javascript:nicTemp();";this.ne.nicCommand("createlink",f);this.ln=this.findElm("A","href",f)}if(this.ln){this.ln.setAttributes({href:this.inputs.href.value,title:this.inputs.title.value,target:this.inputs.target.options[this.inputs.target.selectedIndex].value})}}});nicEditors.registerPlugin(nicPlugin,nicLinkOptions);var nicColorOptions={buttons:{forecolor:{name:__("Change Text Color"),type:"nicEditorColorButton",noClose:true},bgcolor:{name:__("Change Background Color"),type:"nicEditorBgColorButton",noClose:true}}};var nicEditorColorButton=nicEditorAdvancedButton.extend({addPane:function(){var s={0:"00",1:"33",2:"66",3:"99",4:"CC",5:"FF"};var n=new bkElement("DIV").setStyle({width:"270px"});for(var p in s){for(var l in s){for(var k in s){var o="#"+s[p]+s[k]+s[l];var r=new bkElement("DIV").setStyle({cursor:"pointer",height:"15px","float":"left"}).appendTo(n);var m=new bkElement("DIV").setStyle({border:"2px solid "+o}).appendTo(r);var q=new bkElement("DIV").setStyle({backgroundColor:o,overflow:"hidden",width:"11px",height:"11px"}).addEvent("click",this.colorSelect.closure(this,o)).addEvent("mouseover",this.on.closure(this,m)).addEvent("mouseout",this.off.closure(this,m,o)).appendTo(m);if(!window.opera){r.onmousedown=q.onmousedown=bkLib.cancelEvent}}}}this.pane.append(n.noSelect())},colorSelect:function(b){this.ne.nicCommand("foreColor",b);this.removePane()},on:function(b){b.setStyle({border:"2px solid #000"})},off:function(d,c){d.setStyle({border:"2px solid "+c})}});var nicEditorBgColorButton=nicEditorColorButton.extend({colorSelect:function(b){this.ne.nicCommand("hiliteColor",b);this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicColorOptions);var nicImageOptions={buttons:{image:{name:"Add Image",type:"nicImageButton",tags:["IMG"]}}};var nicImageButton=nicEditorAdvancedButton.extend({addPane:function(){this.im=this.ne.selectedInstance.selElm().parentTag("IMG");this.addForm({"":{type:"title",txt:"Add/Edit Image"},src:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},alt:{type:"text",txt:"Alt Text",style:{width:"100px"}},align:{type:"select",txt:"Align",options:{none:"Default",left:"Left",right:"Right"}}},this.im)},submit:function(f){var d=this.inputs.src.value;if(d==""||d=="http://"){alert("You must enter a Image URL to insert");return false}this.removePane();if(!this.im){var e="javascript:nicImTemp();";this.ne.nicCommand("insertImage",e);this.im=this.findElm("IMG","src",e)}if(this.im){this.im.setAttributes({src:this.inputs.src.value,alt:this.inputs.alt.value,align:this.inputs.align.value})}}});nicEditors.registerPlugin(nicPlugin,nicImageOptions);var nicSaveOptions={buttons:{save:{name:__("Save this content"),type:"nicEditorSaveButton"}}};var nicEditorSaveButton=nicEditorButton.extend({init:function(){if(!this.ne.options.onSave){this.margin.setStyle({display:"none"})}},mouseClick:function(){var c=this.ne.options.onSave;var d=this.ne.selectedInstance;c(d.getContent(),d.elm.id,d)}});nicEditors.registerPlugin(nicPlugin,nicSaveOptions);var nicUploadOptions={buttons:{upload:{name:"Upload Image",type:"nicUploadButton"}}};var nicUploadButton=nicEditorAdvancedButton.extend({nicURI:"http://api.imgur.com/2/upload.json",errorText:"Failed to upload image",addPane:function(){if(typeof window.FormData==="undefined"){return this.onError("Image uploads are not supported in this browser, use Chrome, Firefox, or Safari instead.")}this.im=this.ne.selectedInstance.selElm().parentTag("IMG");var b=new bkElement("div").setStyle({padding:"10px"}).appendTo(this.pane.pane);new bkElement("div").setStyle({fontSize:"14px",fontWeight:"bold",paddingBottom:"5px"}).setContent("Insert an Image").appendTo(b);this.fileInput=new bkElement("input").setAttributes({type:"file"}).appendTo(b);this.progress=new bkElement("progress").setStyle({width:"100%",display:"none"}).setAttributes("max",100).appendTo(b);this.fileInput.onchange=this.uploadFile.closure(this)},onError:function(b){this.removePane();alert(b||"Failed to upload image")},uploadFile:function(){var f=this.fileInput.files[0];if(!f||!f.type.match(/image.*/)){this.onError("Only image files can be uploaded");return}this.fileInput.setStyle({display:"none"});this.setProgress(0);var e=new FormData();e.append("image",f);e.append("key","b7ea18a4ecbda8e92203fa4968d10660");var d=new XMLHttpRequest();d.open("POST",this.ne.options.uploadURI||this.nicURI);d.onload=function(){try{var a=JSON.parse(d.responseText)}catch(b){return this.onError()}this.onUploaded(a.upload)}.closure(this);d.onerror=this.onError.closure(this);d.upload.onprogress=function(a){this.setProgress(a.loaded/a.total)}.closure(this);d.send(e)},setProgress:function(b){this.progress.setStyle({display:"block"});if(b<0.98){this.progress.value=b}else{this.progress.removeAttribute("value")}},onUploaded:function(g){this.removePane();var e=g.links.original;if(!this.im){this.ne.selectedInstance.restoreRng();var h="javascript:nicImTemp();";this.ne.nicCommand("insertImage",e);this.im=this.findElm("IMG","src",e)}var f=parseInt(this.ne.selectedInstance.elm.getStyle("width"));if(this.im){this.im.setAttributes({src:e,width:(f&&g.image.width)?Math.min(f,g.image.width):""})}}});nicEditors.registerPlugin(nicPlugin,nicUploadOptions);var nicXHTML=bkClass.extend({stripAttributes:["_moz_dirty","_moz_resizing","_extended"],noShort:["style","title","script","textarea","a"],cssReplace:{"font-weight:bold;":"strong","font-style:italic;":"em"},sizes:{1:"xx-small",2:"x-small",3:"small",4:"medium",5:"large",6:"x-large"},construct:function(b){this.ne=b;if(this.ne.options.xhtml){b.addEvent("get",this.cleanup.closure(this))}},cleanup:function(e){var f=e.getElm();var d=this.toXHTML(f);e.content=d},toXHTML:function(H,F,z){var u="";var C="";var D="";var w=H.nodeType;var E=H.nodeName.toLowerCase();var B=H.hasChildNodes&&H.hasChildNodes();var G=new Array();switch(w){case 1:var v=H.attributes;switch(E){case"b":E="strong";break;case"i":E="em";break;case"font":E="span";break}if(F){for(var t=0;t<v.length;t++){var y=v[t];var A=y.nodeName.toLowerCase();var I=y.nodeValue;if(!y.specified||!I||bkLib.inArray(this.stripAttributes,A)||typeof(I)=="function"){continue}switch(A){case"style":var x=I.replace(/ /g,"");for(itm in this.cssReplace){if(x.indexOf(itm)!=-1){G.push(this.cssReplace[itm]);x=x.replace(itm,"")}}D+=x;I="";break;case"class":I=I.replace("Apple-style-span","");break;case"size":D+="font-size:"+this.sizes[I]+";";I="";break}if(I){C+=" "+A+'="'+I+'"'}}if(D){C+=' style="'+D+'"'}for(var t=0;t<G.length;t++){u+="<"+G[t]+">"}if(C==""&&E=="span"){F=false}if(F){u+="<"+E;if(E!="br"){u+=C}}}if(!B&&!bkLib.inArray(this.noShort,A)){if(F){u+=" />"}}else{if(F){u+=">"}for(var t=0;t<H.childNodes.length;t++){var s=this.toXHTML(H.childNodes[t],true,true);if(s){u+=s}}}if(F&&B){u+="</"+E+">"}for(var t=0;t<G.length;t++){u+="</"+G[t]+">"}break;case 3:u+=H.nodeValue;break}return u}});nicEditors.registerPlugin(nicXHTML);var nicBBCode=bkClass.extend({construct:function(d){this.ne=d;if(this.ne.options.bbCode){d.addEvent("get",this.bbGet.closure(this));d.addEvent("set",this.bbSet.closure(this));var c=this.ne.loadedPlugins;for(itm in c){if(c[itm].toXHTML){this.xhtml=c[itm]}}}},bbGet:function(d){var c=this.xhtml.toXHTML(d.getElm());d.content=this.toBBCode(c)},bbSet:function(b){b.content=this.fromBBCode(b.content)},toBBCode:function(c){function d(b,a){c=c.replace(b,a)}d(/\n/gi,"");d(/<strong>(.*?)<\/strong>/gi,"[b]$1[/b]");d(/<em>(.*?)<\/em>/gi,"[i]$1[/i]");d(/<span.*?style="text-decoration:underline;">(.*?)<\/span>/gi,"[u]$1[/u]");d(/<ul>(.*?)<\/ul>/gi,"[list]$1[/list]");d(/<li>(.*?)<\/li>/gi,"[*]$1[]");d(/<ol>(.*?)<\/ol>/gi,"[list=1]$1[/list]");d(/<img.*?src="(.*?)".*?>/gi,"[img]$1[/img]");d(/<a.*?href="(.*?)".*?>(.*?)<\/a>/gi,"[url=$1]$2[/url]");d(/<br.*?>/gi,"\n");d(/<.*?>.*?<\/.*?>/gi,"");return c},fromBBCode:function(d){function c(b,a){d=d.replace(b,a)}c(/\[b\](.*?)\[\/b\]/gi,"<strong>$1</strong>");c(/\[i\](.*?)\[\/i\]/gi,"<em>$1</em>");c(/\[u\](.*?)\[\/u\]/gi,'<span style="text-decoration:underline;">$1</span>');c(/\[list\](.*?)\[\/list\]/gi,"<ul>$1</ul>");c(/\[list=1\](.*?)\[\/list\]/gi,"<ol>$1</ol>");c(/\[\*\](.*?)\[\/\*\]/gi,"<li>$1</li>");c(/\[img\](.*?)\[\/img\]/gi,'<img src="$1" />');c(/\[url=(.*?)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>');c(/\n/gi,"<br />");return d}});nicEditors.registerPlugin(nicBBCode);nicEditor=nicEditor.extend({floatingPanel:function(){this.floating=new bkElement("DIV").setStyle({position:"absolute",top:"-1000px"}).appendTo(document.body);this.addEvent("focus",this.reposition.closure(this)).addEvent("blur",this.hide.closure(this));this.setPanel(this.floating)},reposition:function(){var c=this.selectedInstance.e;this.floating.setStyle({width:(parseInt(c.getStyle("width"))||c.clientWidth)+"px"});var d=c.offsetTop-this.floating.offsetHeight;if(d<0){d=c.offsetTop+c.offsetHeight}this.floating.setStyle({top:d+"px",left:c.offsetLeft+"px",display:"block"})},hide:function(){this.floating.setStyle({top:"-1000px"})}});var nicCodeOptions={buttons:{xhtml:{name:"Edit HTML",type:"nicCodeButton"}}};var nicCodeButton=nicEditorAdvancedButton.extend({width:"350px",addPane:function(){this.addForm({"":{type:"title",txt:"Edit HTML"},code:{type:"content",value:this.ne.selectedInstance.getContent(),style:{width:"340px",height:"200px"}}})},submit:function(c){var d=this.inputs.code.value;this.ne.selectedInstance.setContent(d);this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicCodeOptions);